# 常见 MySQL 函数分类及使用场景

MySQL 提供了多种函数，主要用于数据处理、计算和转换。根据用途，我们可以将其分为以下几类：

## **1. 字符串函数（String Functions）**

用于处理字符串数据，例如拼接、截取、替换等。

| **函数**             | **作用**                 | **示例**                                | **返回结果**                     |
| -------------------- | ------------------------ | :-------------------------------------- | -------------------------------- |
| `CONCAT()`           | 连接多个字符串           | `SELECT CONCAT('Hello', ' ', 'World');` | `Hello World`                    |
| `SUBSTRING()`        | 截取字符串               | `SELECT SUBSTRING('HelloWorld', 1, 5);` | `Hello`                          |
| `LENGTH()`           | 计算字符串长度（字节数） | `SELECT LENGTH('你好');`                | `6`（UTF-8 中每个汉字占 3 字节） |
| `LEFT()` / `RIGHT()` | 取左/右 N 个字符         | `SELECT LEFT('MySQL', 2);`              | `My`                             |
| `REPLACE()`          | 替换子字符串             | `SELECT REPLACE('apple', 'p', 'b');`    | `abble`                          |
| `TRIM()`             | 去除首尾空格或字符       | `SELECT TRIM(' hello ');`               | `hello`                          |

### **💡 使用场景**

- 处理文本数据，如格式化用户输入、清理多余空格。
- 对日志数据进行分析，如提取 URL 的域名部分。
- 数据脱敏，如替换手机号中间 4 位。

---

## **2. 数值函数（Numeric Functions）**

用于数学计算，如四舍五入、取整、取余等。

| **函数**  | **作用**          | **示例**                    | **返回结果**       |
| --------- | ----------------- | --------------------------- | ------------------ |
| `ABS()`   | 绝对值            | `SELECT ABS(-10);`          | `10`               |
| `ROUND()` | 四舍五入          | `SELECT ROUND(3.14159, 2);` | `3.14`             |
| `FLOOR()` | 向下取整          | `SELECT FLOOR(3.9);`        | `3`                |
| `CEIL()`  | 向上取整          | `SELECT CEIL(3.1);`         | `4`                |
| `MOD()`   | 取模（取余数）    | `SELECT MOD(10, 3);`        | `1`                |
| `RAND()`  | 生成随机数（0~1） | `SELECT RAND();`            | `0.6789`（随机值） |

### **💡 使用场景**

- 计算价格折扣、四舍五入金额等。
- 生成随机推荐商品列表，如 `ORDER BY RAND() LIMIT 5`。
- 处理分页查询时计算偏移量，如 `LIMIT (页码-1) * 每页条数, 每页条数`。

---

## **3. 日期和时间函数（Date & Time Functions）**

用于处理时间数据，如获取当前时间、计算时间间隔等。

| **函数**          | **作用**             | **示例**                                                    | **返回结果**                |
| ----------------- | -------------------- | ----------------------------------------------------------- | --------------------------- |
| `NOW()`           | 获取当前时间         | `SELECT NOW();`                                             | `2025-02-26 14:30:00`       |
| `CURDATE()`       | 获取当前日期         | `SELECT CURDATE();`                                         | `2025-02-26`                |
| `CURTIME()`       | 获取当前时间         | `SELECT CURTIME();`                                         | `14:30:00`                  |
| `DATE_FORMAT()`   | 格式化日期           | `SELECT DATE_FORMAT(NOW(), '%Y-%m-%d');`                    | `2025-02-26`                |
| `DATEDIFF()`      | 计算日期间隔         | `SELECT DATEDIFF('2025-12-31', '2025-01-01');`              | `364`                       |
| `TIMESTAMPDIFF()` | 按不同单位计算时间差 | `SELECT TIMESTAMPDIFF(HOUR, '2025-02-26 12:00:00', NOW());` | `2`（假设当前时间 `14:00`） |

### **💡 使用场景**

- 计算用户注册时间、订单创建时间等时间间隔。
- 统计活跃用户，如 `WHERE DATE(NOW()) = DATE(last_login_time)`。
- 进行定时任务调度，如计算 **7 天后的过期时间**。

---

## **4. 聚合函数（Aggregate Functions）**

用于对多行数据进行计算，如求和、求平均值等。

| **函数**  | **作用**   | **示例**                         | **返回结果**               |
| --------- | ---------- | -------------------------------- | -------------------------- |
| `COUNT()` | 统计记录数 | `SELECT COUNT(*) FROM users;`    | `100`（假设有 100 条记录） |
| `SUM()`   | 求和       | `SELECT SUM(price) FROM orders;` | `5000`                     |
| `AVG()`   | 计算平均值 | `SELECT AVG(price) FROM orders;` | `250`                      |
| `MAX()`   | 求最大值   | `SELECT MAX(price) FROM orders;` | `999`                      |
| `MIN()`   | 求最小值   | `SELECT MIN(price) FROM orders;` | `10`                       |

### **💡 使用场景**

- 统计网站用户数量、计算订单总金额。
- 找到最高价/最低价商品。
- 计算用户平均购买金额。

---

## **5. 控制流函数（Control Flow Functions）**

用于实现类似 **if-else** 的逻辑处理。

| **函数**    | **作用**             | **示例**                                                              | **返回结果**    |
| ----------- | -------------------- | --------------------------------------------------------------------- | --------------- |
| `IF()`      | 条件判断（单个条件） | `SELECT IF(1 > 0, 'YES', 'NO');`                                      | `YES`           |
| `IFNULL()`  | 处理 NULL 值         | `SELECT IFNULL(NULL, '默认值');`                                      | `默认值`        |
| `CASE WHEN` | 多条件判断           | `SELECT CASE WHEN age < 18 THEN '未成年' ELSE '成人' END FROM users;` | `未成年 / 成人` |

### **💡 使用场景**

- 处理 NULL 值，避免 `NULL` 影响计算结果。
- 实现业务逻辑，如根据年龄分组、判断订单状态。

---

## **6. JSON 函数（JSON Functions）**

用于处理 MySQL 5.7+ 支持的 JSON 数据。

| **函数**         | **作用**       | **示例**                                              | **返回结果**                   |
| ---------------- | -------------- | ----------------------------------------------------- | ------------------------------ |
| `JSON_OBJECT()`  | 创建 JSON 对象 | `SELECT JSON_OBJECT('name', 'Alice', 'age', 25);`     | `{"name": "Alice", "age": 25}` |
| `JSON_EXTRACT()` | 获取 JSON 值   | `SELECT JSON_EXTRACT('{"name": "Alice"}', '$.name');` | `"Alice"`                      |
| `JSON_ARRAY()`   | 创建 JSON 数组 | `SELECT JSON_ARRAY(1, 2, 3);`                         | `[1,2,3]`                      |

### **💡 使用场景**

- 存储和查询 JSON 格式的数据，如 `JSON_EXTRACT(order_data, '$.price')`。
- 处理灵活的商品规格、用户设置等动态数据。

---

## **总结**

| **函数类别**      | **适用场景**                               |
| ----------------- | ------------------------------------------ |
| **字符串函数**    | 处理文本数据，如格式化用户输入、提取关键词 |
| **数值函数**      | 计算价格、随机排序、分页查询               |
| **日期/时间函数** | 计算时间间隔、统计活跃用户                 |
| **聚合函数**      | 统计数据，如求和、计算平均值               |
| **控制流函数**    | 处理业务逻辑，如分类、替换 NULL            |
| **JSON 函数**     | 处理 JSON 格式数据                         |
